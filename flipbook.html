<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Volume 1 Flipbook</title>

<!-- Retro magazine font -->
<link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* ------------------------------------------------------ */
/* GLOBAL aesthetic */
/* ------------------------------------------------------ */
body {
    margin: 0;
    user-select: none;

    /* pastel gradient + faint pattern */
    background: linear-gradient(160deg, #f2f7f3, #e8f1ea, #f7f3ea);
    background-size: 400% 400%;
    animation: bgFlow 14s ease infinite;

    /* subtle paper texture */
    background-image:
        radial-gradient(rgba(0,0,0,0.02) 1px, transparent 1px),
        linear-gradient(160deg, #f2f7f3 0%, #e8f1ea 50%, #f7f3ea 100%);
    background-size: 12px 12px, 100% 100%;
    font-family: "Inter", sans-serif;
}

@keyframes bgFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* Retro magazine title */
h1 {
    text-align: center;
    padding: 28px 0 8px;
    font-family: "Fraunces", serif;
    font-weight: 600;
    font-size: 2.7rem;
    letter-spacing: 1px;
    color: #2d392f;
}

/* ------------------------------------------------------ */
/* BOOK CONTAINER */
/* ------------------------------------------------------ */
#book {
    width: 750px;
    height: 530px;
    margin: 20px auto;
    position: relative;
    perspective: 2400px;
    perspective-origin: 50% 40%;
}

/* Static pages */
.page {
    width: 375px;
    height: 100%;
    position: absolute;
    top: 0;
    overflow: hidden;
    background: white;
    border-radius: 4px;
    box-shadow: 0 0 18px rgba(0,0,0,0.15);
    backface-visibility: hidden;
    transform-style: preserve-3d;
}

.left { left: 0; }
.right { left: 375px; }

/* Page images */
.page img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    backface-visibility: hidden;
}

/* ------------------------------------------------------ */
/* FLIP PAGE (animated) */
/* ------------------------------------------------------ */
.flip {
    width: 375px;
    height: 100%;
    position: absolute;
    top: 0;
    overflow: hidden;
    background: white;
    display: none;
    transform-style: preserve-3d;
    backface-visibility: hidden;

    /* softer, more book-like curl */
    transition: transform 1.0s cubic-bezier(.25,.8,.35,1);
}

/* soften curve mid-flip */
.flip img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transform-origin: left center;
}

/* highlight + shadow */
.flip::before {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(
        ellipse at right,
        rgba(255,255,255,0.25),
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.6s ease;
}

.flip::after {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(
        to left,
        rgba(0,0,0,0.35),
        rgba(0,0,0,0.15),
        transparent
    );
    width: 55%;
    opacity: 0;
    transition: opacity 0.6s ease;
}

.flip.flipping::before,
.flip.flipping::after {
    opacity: 1;
}

.flip.dragging {
    transition: none !important; /* JS controls rotation while dragging */
    cursor: grabbing;
}

.flip.dragging img {
    transform-origin: left center;
    transform: scaleX(0.96) skewY(1.2deg);
}

.flip.dragging::after {
    opacity: 0.35; /* stronger inner shadow while dragging */
}

/* ------------------------------------------------------ */
/* CORNER HOTSPOTS (click-to-flip) */
/* ------------------------------------------------------ */
.corner {
    position: absolute;
    width: 50px;
    height: 50px;
    z-index: 99;
    cursor: pointer;
}

#cornerRight {
    right: 0;
    bottom: 0;
}

#cornerLeft {
    left: 0;
    bottom: 0;
}

.corner:hover {
    background: radial-gradient(circle at bottom right,
        rgba(0,0,0,0.08), transparent);
    border-bottom-right-radius: 10px;
}

/* ------------------------------------------------------ */
/* Controls */
/* ------------------------------------------------------ */
.controls {
    text-align: center;
    margin: 15px 0;
}

.ctrl {
    padding: 8px 20px;
    margin: 0 6px;
    border: none;
    border-radius: 10px;
    background: #8fbf9f;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: 0.25s ease;
    box-shadow: 0 3px 7px rgba(0,0,0,0.15);
}

.ctrl:hover {
    background: #7aaa8b;
    transform: translateY(-2px);
}

/* ------------------------------------------------------ */
#thumbStrip {
    width: 100%;
    display: flex;
    overflow-x: auto;
    gap: 12px;
    padding: 15px;
    justify-content: center;
}

.thumbnail {
    width: 75px;
    height: 105px;
    object-fit: cover;
    border-radius: 4px;
    cursor: pointer;
    border: 2px solid transparent;
    transition: 0.2s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.thumbnail:hover {
    border-color: #8fbf9f;
}
</style>
</head>

<body>

<h1>VOLUME 1</h1>

<div id="book">
    <div class="page left" id="leftPage"></div>
    <div class="page right" id="rightPage"></div>
    <div class="flip" id="flipPage"></div>

    <!-- Corner click zones -->
    <div id="cornerRight" class="corner"></div>
    <div id="cornerLeft" class="corner"></div>
</div>

<div class="controls">
    <button id="firstBtn" class="ctrl">⏮</button>
    <button id="prevBtn" class="ctrl">←</button>
    <button id="nextBtn" class="ctrl">→</button>
    <button id="lastBtn" class="ctrl">⏭</button>
</div>

<div id="thumbStrip"></div>

<script>
/* PAGE LIST — same as your original */
const pages = [
    "pages/vol1/2.png",
    "pages/vol1/3.png",
    "pages/vol1/4.png",
    "pages/vol1/5.png",
    "pages/vol1/6.png",
    "pages/vol1/7.png",
    "pages/vol1/8.png",
    "pages/vol1/9.png",
    "pages/vol1/10.png",
    "pages/vol1/11.png",
    "pages/vol1/12.png",
    "pages/vol1/13.png",
    "pages/vol1/14.png",
    "pages/vol1/15.png",
    "pages/vol1/16.png",
    "pages/vol1/17.png",
    "pages/vol1/18.png",
    "pages/vol1/19.png",
    "pages/vol1/20.png",
    "pages/vol1/21.png",
    "pages/vol1/22.png",
    "pages/vol1/23.png",
    "pages/vol1/24.png",
    "pages/vol1/25.png",
    "pages/vol1/26.png",
    "pages/vol1/27.png",
    "pages/vol1/28.png",
    "pages/vol1/29.png",
    "pages/vol1/30.png",
    "pages/vol1/31.png",
    "pages/vol1/32.png",
    "pages/vol1/33.png",
    "pages/vol1/34.png",
    "pages/vol1/35.png"
];

pages.forEach(src => { const img = new Image(); img.src = src; });

let spread = 0;
let isDragging = false;
let dragStartX = 0;
let dragSide = null;
const leftPage = document.getElementById("leftPage");
const rightPage = document.getElementById("rightPage");
const flipPage = document.getElementById("flipPage");

function startDrag(e, side) {
    const rect = book.getBoundingClientRect();
    dragStartX = e.clientX;
    dragSide = side;
    isDragging = true;

    // Set up flip page
    flipPage.style.display = "block";
    flipPage.classList.add("dragging");

    if (side === "right") {
        flipPage.style.left = "375px";
        flipPage.style.transformOrigin = "left center";
        flipPage.innerHTML = `<img src="${pages[spread * 2]}">`;
    } else {
        flipPage.style.left = "0px";
        flipPage.style.transformOrigin = "right center";
        flipPage.innerHTML = `<img src="${pages[(spread * 2) - 1]}">`;
    }
}

function duringDrag(e) {
    if (!isDragging) return;

    const delta = e.clientX - dragStartX;
    let rotation;

    if (dragSide === "right") {
        rotation = Math.max(-180, Math.min(0, (delta / 2)));
    } else {
        rotation = Math.min(180, Math.max(0, (delta / 2)));
    }

    flipPage.style.transform = `rotateY(${rotation}deg)`;
}

function endDrag(e) {
    if (!isDragging) return;
    isDragging = false;

    const delta = e.clientX - dragStartX;

    flipPage.classList.remove("dragging");

    const threshold = 80; // how far to drag before flipping

    if (dragSide === "right") {
        if (delta < -threshold) {
            animateFlip("forward", spread + 1);
        } else {
            cancelDrag();
        }
    } else {
        if (delta > threshold) {
            animateFlip("backward", spread - 1);
        } else {
            cancelDrag();
        }
    }
}

function cancelDrag() {
    flipPage.style.transition = "transform 0.4s ease";
    flipPage.style.transform = "rotateY(0deg)";
    flipPage.addEventListener("transitionend", () => {
        flipPage.style.display = "none";
        flipPage.style.transition = "none";
    }, { once: true });
}

function renderPages() {
    const maxSpread = Math.floor((pages.length - 1) / 2);

    // COVER
    if (spread === 0) {
        leftPage.style.display = "none";
        rightPage.style.display = "block";
        rightPage.innerHTML = `<img src="${pages[0]}">`;
        return;
    }
    // LAST PAGE
    if (spread === maxSpread) {
        rightPage.style.display = "none";
        leftPage.style.display = "block";
        leftPage.innerHTML = `<img src="${pages[pages.length - 1]}">`;
        return;
    }

    leftPage.style.display = "block";
    rightPage.style.display = "block";

    leftPage.innerHTML = `<img src="${pages[spread * 2 - 1]}">`;
    rightPage.innerHTML = `<img src="${pages[spread * 2]}">`;
}

function animateFlip(direction, nextSpread) {
    const forward = direction === "forward";
    const maxSpread = Math.floor((pages.length - 1) / 2);

    let flippingImg;

    if (spread === 0 && forward) {
        flippingImg = pages[0];
        flipPage.style.left = "375px";
        flipPage.style.transformOrigin = "left center";
    }
    else if (spread === maxSpread && !forward) {
        flippingImg = pages[pages.length - 1];
        flipPage.style.left = "0px";
        flipPage.style.transformOrigin = "right center";
    }
    else if (forward) {
        flippingImg = pages[spread * 2];
        flipPage.style.left = "375px";
        flipPage.style.transformOrigin = "left center";
    }
    else {
        flippingImg = pages[(nextSpread * 2) - 1];
        flipPage.style.left = "0px";
        flipPage.style.transformOrigin = "right center";
    }

    flipPage.innerHTML = `<img src="${flippingImg}">`;
    flipPage.style.display = "block";
    flipPage.classList.add("flipping");

    flipPage.style.transition = "none";
    flipPage.style.transform = "rotateY(0deg)";

    requestAnimationFrame(() => {
        flipPage.style.transition = "transform 1.0s cubic-bezier(.25,.8,.35,1)";
        flipPage.style.transform = forward
            ? "rotateY(-179deg)"
            : "rotateY(179deg)";
    });

    flipPage.addEventListener("transitionend", () => {
        flipPage.style.display = "none";
        flipPage.classList.remove("flipping");
        flipPage.style.transform = "rotateY(0deg)";
        spread = nextSpread;
        renderPages();
    }, { once: true });
}

/* Buttons */
document.getElementById("nextBtn").onclick = () => {
    const maxSpread = Math.floor((pages.length - 1) / 2);
    if (spread < maxSpread) animateFlip("forward", spread + 1);
};

document.getElementById("prevBtn").onclick = () => {
    if (spread > 0) animateFlip("backward", spread - 1);
};

document.getElementById("firstBtn").onclick = () => {
    if (spread !== 0) animateFlip("backward", 0);
};

document.getElementById("lastBtn").onclick = () => {
    const maxSpread = Math.floor((pages.length - 1) / 2);
    if (spread < maxSpread) animateFlip("forward", maxSpread);
};

/* Corner click zones */
document.getElementById("cornerRight").addEventListener("pointerdown", (e) => {
    const maxSpread = Math.floor((pages.length - 1) / 2);
    if (spread < maxSpread) startDrag(e, "right");
});

// LEFT CORNER
document.getElementById("cornerLeft").addEventListener("pointerdown", (e) => {
    if (spread > 0) startDrag(e, "left");
});

// Global pointer listeners
window.addEventListener("pointermove", duringDrag);
window.addEventListener("pointerup", endDrag);

/* Thumbnails */
pages.forEach((src, index) => {
    const thumb = document.createElement("img");
    thumb.src = src;
    thumb.className = "thumbnail";

    thumb.onclick = () => {
        const targetSpread = Math.floor(index / 2);
        if (targetSpread > spread) animateFlip("forward", targetSpread);
        else if (targetSpread < spread) animateFlip("backward", targetSpread);
    };

    document.getElementById("thumbStrip").appendChild(thumb);
});

renderPages();
</script>

</body>
</html>
